<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<% include ./partials/head %>

<body>

<p>
ID: <%= user.id %><br/>
Name: <%= user.displayName %><br/>
</p>
<select id="selectPage">
    <option>Choose a Page</option>
</select>
<br/>
<p><%= JSON.stringify(user, null, 4) %></p>


<script>
function getPages(id, cb) {
    if (!cb) cb = Function.prototype
    request({
      method: 'GET',
      uri: `https://graph.facebook.com/v2.8/${id}/accounts`,
      qs: {
        fields: 'name',
        access_token: process.env.page_token
      },
      json: true
    }, function(err, res, body) {
      if (err) return cb(err)
      if (body.error) return cb(body.error)
      console.log(body)
      cb(null, body)
    })
}

window.onload = getPages( req.user.id ,function(err, pages) {
  var select = document.getElementById("selectPage");
  var array = pages
  for(var i = 0; i < array.length; i++) {
      var opt = array[i];
      var el = document.createElement("option");
      el.textContent = opt.name;
      el.value = opt.id;
      select.appendChild(el);
  }
}
</script>
</body>
